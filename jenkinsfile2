pipeline {
  agent any

  stages {
    stage('Backup') {
      steps {
        sh '''
          docker run --rm -v jenkins_data:/volume -v /home/rodrigo/test/:/test -v ~/.aws:/root/.aws alpine sh -c "mkdir -p /test && cd /volume && tar -czf /test/jenkins-data.tar.gz ."
           '''
      }
    }

    stage('Sending') {
      steps {
        sh '''
          aws s3 sync /home/rodrigo/test/jenkins-data.tar.gz s3://www.aulacloudcba.com/
           '''
      }
    }
  }
}